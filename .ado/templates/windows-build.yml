parameters:
  - name: Flavor
  - name: Architecture
  - name: WinSDK
    default: '10.0.18362.0'

steps:
  - script: choco install ninja
    displayName: Install Ninja

  - task: BatchScript@1
    displayName: Setup Visual C++ Environment
    inputs:
      filename: 'C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat'
      arguments: '$(Architecture) $(WinSDK)'
      modifyEnvironment: true

  - task: CMake@1
    displayName: Generate Ninja Build
    inputs:
      workingDirectory: $(Build.BinariesDirectory)/$(Flavor)/$(Architecture)
      cmakeArgs: -G Ninja -DFLAVOR=$(Flavor) -DCMAKE_TOOLCHAIN_FILE=$(Build.SourcesDirectory)\CMake\toolchain.windows.cmake $(Build.SourcesDirectory)

  - task: CmdLine@2
    displayName: Build
    inputs:
      workingDirectory: $(Build.BinariesDirectory)/$(Flavor)/$(Architecture)
      script: ninja -v
